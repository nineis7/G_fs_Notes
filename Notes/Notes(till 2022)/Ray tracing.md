导致其渲染效果的光线追踪技术的现实在计算机视觉和工业应用中日益显现。然而，由于内存访问问题、发散的分支和令人生畏的计算强度，设计高效的光线跟踪硬件具有挑战性。本文提出了一种新的加速射线追踪的RT引擎(射线追踪引擎)。首先，我们为每条射线设置了多个栈来存储信息，使得RT引擎可以在系统中并行处理多条射线。这些栈中的信息可以有效地提高系统的性能。其次，我们在三角形相交测试时选择了三相断开的方法，可以使环路提前断开。第三，倒易单元采用抛物线综合与二次插值相结合的逼近方法。结合这些策略，我们使用敏捷的芯片开发在RTL级实现了我们的系统。仿真和实验结果表明，我们的架构在专用硬件上实现了比目前最好的射线追踪结果高2.4倍的单位面积性能。

intro

作为计算机图形学的中心课题，渲染是从三维场景中合成图像的过程。领域绘制算法分为栅格化[ 1 ]和光线追踪[ 2 ]两个分支。栅格化方法将场景中的几何图形映射为像素。该方法在硬件加速方面非常有效。目前，大多数图形处理器( GPU )采用栅格化方法生成三维照片。但是由于其只处理局部光照，图像质量有限。另一方面，光线追踪技术生成高质量的三维照片。它通过模拟光的反射、折射、阴影等光学特性来生成三维图像。许多现代图形应用、高端游戏[ 3 ]、电影特效[ 4 ]、虚拟现实( Virtual Reality，VR ) [ 5 ]、计算机辅助设计等都需要高质量的视觉体验。
光线追踪的本质是在三维场景中找到与光线相交的最接近的物体，然后将相交测试的结果传输给着色器进行图着色。为了加快测试速度，研究人员提出了加速结构( AS )。其思想是将图形基元排列成层次化的空间结构。通过这种方式，射线和场景的测试可以快速剔除那些不相关的空间，识别出与射线最接近的图元。

目前广泛使用的加速度结构为树形结构。树的叶子节点包括所有的场景基元，树的内部节点用于将一个可尺寸的空间表示细分为多个较小的空间区域( KDtrees [ 6 ] )或将场景中的对象分解为较小的对象集(包围体层次( BVH )) [ 7 ] )。基于空间结构，射线追踪分为两个主要部分：具有加速结构的射线遍历和射线与基元的交集检验。该部分的计算是改进光线追踪性能的主要瓶颈之一。本次试验占总计算时间的近70 ~ 80 %。因此，很多研究都在关注实现更高性能的射线遍历和交叉测试。
在过去的几十年里，国内外许多研究人员对射线追踪软件和硬件加速进行了大量的研究。在硬件加速层面使用各种平台，包括中央处理器( CPU )、GPU和专用硬件。由于硬件特性，GPU和专用硬件表现出显著的性能优势。在优化GPU加速方面已有大量研究。光线追踪在GPU上实现具有挑战性，因为早期的GPU不支持通用计算。Nathan A . Carr等人[ 9 ]首次尝试在GPU上实现射线追踪。然而，他们只实现了交集测试。该单元将几何图形引擎重新配置为光线引擎，可以高效地交叉光线缓存，用于许多基于主机的渲染任务。Timo Aila等人[ 10 ]研究了基元加速结构遍历和基元相交在宽单指令多数据( SIMD ) /单指令多线程( SIMT )机器上的映射。Yahshua L ü等人[ 11 ]提出了GPU的动态光线漂移( Dynamic Ray Shuffling，DRS )架构来解决光线跟踪控制流发散问题。关键的见解是，通过DRS可以消除由经线的不一致光线遍历状态引起的主控制流发散。实验结果表明，对于0.11 %的面积成本，DRS显著提高了测试基准的SIMD效率，平均从41.06 %提高到81.04 %。刘路飞等。Lufei Liu等[ 12 ]探索将射线预测策略集成到现有的GPU管道中，通过预测树中较高的节点，并以低成本、合理的方式重新组合和调度遍历操作来提高预测效果。他们发现GPU平台优化更注重算法的计算部分。通过架构的优化策略减少分支的处理，减少冗余操作以最大化硬件特性，在学术研究中取得了良好的收益。此外，商业GPU也引入了用于光线追踪的加速架构。2018年，NVIDIA推出了第一款基于图灵架构第一代RT Core的光线追踪GPU [ 13 ]。2021年，具有第二代RT Core的安培架构建立[ 14 ]。RT Cores代替软件仿真，执行树遍历、ray / box和射线与三角形求交测试。射线查询从流式多处理器( SM )发送到RT Core。RT Core使用专门的评估人员来测试每条射线对方框，或者在树叶处测试组成场景的三角形。它反复这样做，可选地跟踪找到的最近的交叉点。当确定合适的交点后，将结果返回给SM进一步处理。2021年，Imagination将PowerVR Photon架构的光线加速集群( Ray Acceleration Cluster，RAC )加入C系列GPU，为手机市场提供光线追踪IP技术[ 15 ]。RAC使用高度并行的Dual Triangle Tester Unit来提高硬件计算的效率。其主要功能是同时进行两个三角形的相交测试，并将处理结果发送给下一阶段。该系列GPU分为应用于移动和超越移动配置的单核和多核模型。

从现有的学术研究成果和商用GPU来看，射线追踪加速随着算法的进步和工业技术的发展，计算能力逐渐提高。由于不同设计采用的算法不同以及射线追踪硬件架构的用途不同，导致很多策略在性能和硬件资源开销上存在相当大的差异。然而，它们都有一定的性能/面积限制，我们正在关注一种更高效的射线追踪硬件架构。我们对文献的主要贡献如下：( 1 )分别针对射线追踪存储器访问、分支和功能单元的三种优化方法；( 2 )基于面积有效的并行流水线射线遍历与求交单元的新型硬件架构；( 3 )在RTL级实现整个系统并评估硬件资源开销。